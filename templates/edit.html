<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>编辑故障记录</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- ==================== 新增：头部容器 ==================== -->
    <div class="header-container">
        <h1>编辑故障记录 #{{ fault.id }}</h1>
        <!-- ==================== 新增：登录/登出链接区域 ==================== -->
        <div class="auth-links">
            {% if session.user == 'root' %}
                <span class="welcome-message">欢迎, 管理员!</span>
                <a href="{{ url_for('logout') }}" class="button-logout">登出</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="button-login">管理员登录</a>
            {% endif %}
        </div>
    </div>

    <!-- Flash 消息显示（用于显示更新成功或失败的消息） -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
        {% for category, msg in messages %}
            <div class="flash flash-{{ category }}">{{ msg }}</div>
        {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <hr>

    <!-- 编辑表单 -->
    <form method="post">
        <!-- 基础信息编辑 -->
        <label>发现人员:
            <input type="text" name="reporter_name" value="{{ fault.reporter_name }}" required>
        </label>
        <label>故障发生时间:
            <!-- 注意：datetime-local 需要的格式是 YYYY-MM-DDTHH:MM -->
            <input type="datetime-local" name="fault_time" value="{{ fault.fault_time.strftime('%Y-%m-%dT%H:%M') }}" required>
        </label>
        <label>车辆编号:
            <input type="text" name="vehicle_id" value="{{ fault.vehicle_id }}" required>
        </label>
        <label>错误类别:
            <select name="category" required>
                <!-- 【核心修改】解包元组 (name, desc)，并用 name 进行比较 -->
                {% for name, desc in categories %}
                <option value="{{ name }}" {% if name == fault.category %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </label>
        <label>故障详细描述:
            <textarea name="description" rows="6" required>{{ fault.description }}</textarea>
        </label>
        <label>责任人:
            <input type="text" name="responsible_person" value="{{ fault.responsible_person }}" required>
        </label>

        <hr> <!-- 添加分隔线以区分基础信息和处理信息 -->

        <!-- 状态与处理记录编辑 -->
        <label>解决状态:
            <select name="status">
                {% for s in statuses %}
                <option value="{{ s }}" {% if s == fault.status %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </label>
        <label>处理记录:
            <textarea name="resolution_log" rows="6">{{ fault.resolution_log or '' }}</textarea>
        </label>

        <button type="submit">更新记录</button>
    </form>

    <div class="nav-links">
        <a href="{{ url_for('index') }}">返回首页</a>
    </div>
</body>
</html>